\documentclass[11pt]{amsart}          
\usepackage{amsfonts}
\usepackage{amssymb}  
\usepackage{amsthm} 
\usepackage{amsmath} 
\usepackage{tikz-cd}
\usepackage{float}
\usepackage[]{hyperref}
\usepackage{minted}
\hypersetup{
  colorlinks,
  linkcolor=blue,
  citecolor=blue,
  urlcolor=blue}
\newcommand{\hask}[1]{\mintinline{Haskell}{#1}}
\newenvironment{haskell}
  {\VerbatimEnvironment
  	\begin{minted}[escapeinside=??, mathescape=true,frame=single, framesep=5pt, tabsize=1]{Haskell}}
  {\end{minted}}
\newcommand{\cat}[1]{\mathcal{#1}}%a generic category
\newcommand{\Cat}[1]{\mathbf{#1}}%a named category
\newcommand{\Set}{\Cat{Set}}

\author{Bartosz Milewski}
\title{Presheaf Optics}
\begin{document}
\maketitle{}

\section{Motivation}

A lot of optics can be defined using the existential, or coend, representation:
\[ \mathcal{O}\langle a, b\rangle \langle s, t \rangle = \int^{m \colon \cat M} \cat C (s, m \bullet a) \times \cat D ( m \bullet b, t) \]
Here $\cat M$ is a monoidal category with an action on objects of two categories $\cat C$ and $\cat D$ (I'll use the same notation for both actions).

The idea is that we have a pair of morphisms, one decomposing the source $s$ into the action of some $m$ on $a$, and the other recomposing the target $t$ from the action of the same $m$ on $b$. In most applications we pick $\cat D$ to be the same category as $\cat C$.

Recently, there has been renewed interest in polynomial functors. Morphisms between polynomial functors form a new kind of optics that doesn't neatly fit this mold. They do, however, admit an existential representation or the form:
\[ \int^{c_{k i}} 
 \prod_{k \in K} \mathbf{Set} \left(s_k,  \sum_{n \in N} a_n \times c_{n k} \right) \times 
 \prod_{i \in K}  \mathbf{Set} \left(\sum_{m \in N} b_m \times c_{m i}, t_i \right) \]
Here the sets $s_k$ and $t_i$ can be treated as fibers over the set $K$, while the sets $a_n$ and $b_m$ are fibers over a different set $N$. 

We can treat these fibrations as functors from discrete categories to $\Set$, that is co-presheaves. For instance $a_n$ is the result of a co-presheaf $a$ acting on an object $n$ of a discrete category $\cat N$. The products over $K$ can be interpreted as ends that define natural transformations between co-presheaves. The problem is that the matrices $c_{n k}$ are fibrated over two different sets. I have previously interpreted them as profunctors:
\[ c \colon \cat N^{op} \times \cat K \to \Set \]
In this post I will elaborate on this interpretation.

\section{Co-presheaves}

A co-presheaf category  $[\cat C, Set ]$ behaves, in many respects, like a vector space. For instance, it has a ``basis'' consisting of representable functors $\cat C (r, -)$; in the sense that any co-presheaf is as a colimit of representables. Moreover, colimit-preserving functors between co-presheaf categories are very similar to linear transformations between vector spaces. Of particular interest are functors that are left adjoint to some other functors, since left adjoints preserve colimits. 

The polynomial lens formula has a form that suggests vector-space interpretation. We have one vector space with vectors $\vec{s}$ and $\vec{t}$ and another with $\vec{a}$ and $\vec{b}$. Rectangular matrices $c_{n k}$ can be seen as components of a linear transformation between these two vector spaces. We can, for instance, write:
\[  \sum_{n \in N} a_n \times c_{n k} = c^T a \]
where $c^T$ is the transposed matrix, which we can interpret as the analog of a left adjoint. 

We can now re-interpret the polynomial lens formula in terms of co-presheaves. We no longer intepret $\cat N$ and $\cat K$ as discrete categories. We have:
\[ s, t \colon [\cat K, \Set] \]
\[a, b \colon [\cat N, \Set] \]
In this interpretation $c$ is a functor:
\[ c \colon [\cat N, \Set] \to [\cat K, \Set] \]
We'll write the action of this functor on a presheaf $a$ as $c \bullet a$.

We assume that this functor is a left adjoint and therefore preserves colimits. 

\[ [\cat K, \Set] (c \bullet a, t) \cong [\cat N, \Set] (a, c^{\dagger} \bullet t) \]
where:
\[ c^{\dagger} \colon [\cat K, \Set] \to [\cat N, \Set] \]

We can now generalize the polynomial optic formula to:
\[ \int^{c} 
 [\cat K, \Set] \left(s,  c \bullet a \right) \times 
 [\cat K, \Set] \left(c \bullet b, t \right) \]


\section{Actegories and Optics}

An actegory is a category $\cat C$ with a (coherent) action of a monoidal category $\cat M$. We write such an action as:
\[ \bullet \colon \cat M \times \cat C \to \cat C \]
Alternatively, we can curry it to produce a mapping of $\cat M$ to a category of endofunctors:
\[ \cat M \to [\cat C, \cat C] \]
Coherence conditions for the action translate directly to the requirement that this mapping be a strict monoidal functor. 




Actegories for a given $\cat M$ form a 2-category. Here, I'd like to define a larger category that combines actegories for different monoidal categories.

We start with two monoidal categories $\cat M$ and $\cat N$ with two separate actions on two categories:
\begin{align*} 
\bullet &\colon \cat M \times \cat C \to \cat C 
\\
 \bullet &\colon \cat N \times \cat D \to \cat D 
\end{align*}
The two monoidal actions can also be seen, after currying, as strict monoidal functors:
\begin{align*}
&\cat M \to [\cat C, \cat C]
\\
&\cat N \to [\cat D, \cat D]
\end{align*}

Next we consider a category of monoidal functors $\cat M \to \cat N$. Given a functor $c$, we'll write its action on an object $m \colon \cat M$ as $c \cdot m$. It is given in terms of composition of the underlying functors. This action produces an object of $\cat N$. It satisfies the usual associativity and unit conditions of a monoidal functor. 

We also demand that there be a left adjoint to this functor, defining the action of $c$ on $\cat N$:

\[ \cat N (n, c \cdot m) \cong \cat M (c^{\dagger} n, m) \]

We lift the action of $c$ to a functor from $\cat C$ to  $\cat D$, or the action:
\[ \bullet \colon \cat M \times \cat C \to \cat D \]
satisfying the coherence conditions:
\[
 \begin{tikzcd}
 a
 \arrow [r, "m \bullet"] 
 \arrow [d, "(c \cdot m) \bullet"']
 & m \bullet a
 \arrow [d, "c \bullet"]
 \\
 (c \cdot m) \bullet a
 \arrow [r, "\cong"]
 & c \bullet (m \bullet a)
 \end{tikzcd}
\]

\[
 \begin{tikzcd}
 a
 \arrow [r, "c \bullet"] 
 \arrow [d, "(n \cdot c) \bullet"']
 & c \bullet a
 \arrow [d, "n \bullet"]
 \\
 (n \cdot c) \bullet a
 \arrow [r, "\cong"]
 & n \bullet (c \bullet a)
 \end{tikzcd}
\]
where $n \cdot c$ is defined as $c^{\dagger} n$.

We demand that there be an adjoint action:

\[ \cat D (b, c \bullet a) \cong \cat C (c^{\dagger} \bullet b, a) \]

\section{Appendix}

\[P \colon \cat D^{op} \times \cat C \to \Set \]
\[ \Psi \colon [\cat D, \Set] \to [\cat C, \Set] \]


\[ F \colon [\cat D, \Set] \]
$\Psi$ is a left adjoint so it preserves colimits.
\[P \langle d, c \rangle = \Psi ( \cat D(d, -)) c \]


\[ \Psi (F) c = \int^{d'} F d' \times P \langle d', c \rangle \]

Show that these are the inverse of each other. Inserting the formula for $\Psi$ in the definition of $P$ should gives us $P$ back:
\[  \int^{d'} \cat D(d, -) d' \times P\langle d', c \rangle \cong  P \langle d, c \rangle \]
which follows from the co-Yoneda lemma.

Inserting the formula for $P$ into the definition of $\Psi$ should give us $\Psi$ back:
\[  \int^{d'} F d' \times \Psi(\cat D(d', -)) c  \cong \Psi (F) c  \]


To prove this, we check it first on representables of the form:
\[ F d = \cat D (r, d) \]
We want to show that:
\[ \int^{d'}  \cat D (r, d')  \times  \Psi(\cat D(d', -)) c \cong  \Psi ( \cat D (r, -) ) c\]
This follows from the co-Yoneda lemma.

Every co-presheaf is a colimit of representables. Since $\Psi$ is a left adjoint, it preserves all colimits, so the formula works for any co-presheaf.


\end{document}